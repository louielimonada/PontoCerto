<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PontoCerto - Controle de Horas Trabalhadas</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap" rel="stylesheet">
<style>
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f5f7fa; }
    .card { transition: all 0.3s ease; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); }
    .card:hover { box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1); }
    .btn-primary { background-color: #4f46e5; transition: all 0.3s ease; }
    .btn-primary:hover { background-color: #4338ca; }
    .day-normal { background-color: #e0f2fe; }
    .day-holiday { background-color: #fee2e2; }
    .day-sunday { background-color: #fef3c7; }
    #timerDisplay { font-family: 'Orbitron', monospace; font-size: 3rem; font-weight: 700; color: #4f46e5; background: #f5f7fa; padding: 1rem; border-radius: 0.5rem; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); display: inline-block; min-width: 250px; text-align: center; }
    .history-item:hover { transform: translateX(5px); }
</style>
</head>
<body class="bg-gray-50">
<div class="container mx-auto px-4 py-8 max-w-6xl">
<header class="mb-10 text-center">
<h1 class="text-3xl md:text-4xl font-bold text-indigo-800 mb-2"><i class="fas fa-clock mr-2"></i>PontoCerto</h1>
<p class="text-gray-600">Controle suas horas trabalhadas e cálculos de pagamento</p>
</header>

<div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
<div class="lg:col-span-2">
<div class="card bg-white rounded-lg p-6 mb-6">
<h2 class="text-xl font-semibold mb-4 text-indigo-700"><i class="fas fa-plus-circle mr-2"></i>Registrar Jornada</h2>

<div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
<div>
<label class="block text-sm font-medium text-gray-700 mb-1">Data</label>
<input type="date" id="workDate" class="w-full p-2 border border-gray-300 rounded-md" value="">
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-1">Tipo de Dia</label>
<select id="dayType" class="w-full p-2 border border-gray-300 rounded-md">
<option value="normal">Dia Normal</option>
<option value="sunday">Domingo</option>
<option value="holiday">Feriado</option>
</select>
</div>
</div>

<div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
<div>
<label class="block text-sm font-medium text-gray-700 mb-1">Hora de Entrada</label>
<input type="time" id="startTime" class="w-full p-2 border border-gray-300 rounded-md">
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-1">Hora de Saída</label>
<input type="time" id="endTime" class="w-full p-2 border border-gray-300 rounded-md">
</div>
</div>

<div class="mb-4">
<label class="block text-sm font-medium text-gray-700 mb-1">Pausas (em minutos)</label>
<input type="number" id="breakTime" min="0" value="0" class="w-full p-2 border border-gray-300 rounded-md">
</div>

<div class="mb-4">
<label class="block text-sm font-medium text-gray-700 mb-1">Valor por Hora (R$)</label>
<input type="number" id="hourlyRate" min="0" step="0.01" class="w-full p-2 border border-gray-300 rounded-md" value="50.00">
</div>

<div class="flex justify-between">
<button id="startTimerBtn" class="btn-primary text-white px-4 py-2 rounded-md"><i class="fas fa-play mr-2"></i>Iniciar Timer</button>
<button id="saveEntryBtn" class="btn-primary text-white px-4 py-2 rounded-md"><i class="fas fa-save mr-2"></i>Salvar Registro</button>
</div>

<div id="timerSection" class="mt-4 hidden">
<div class="text-center">
<div id="timerDisplay" class="mb-6">00:00:00</div>
<div class="flex justify-center space-x-4">
<button id="stopTimerBtn" class="btn-primary text-white px-6 py-3 rounded-lg text-lg"><i class="fas fa-stop mr-2"></i>Parar Timer</button>
<button id="resetTimerBtn" class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-lg text-lg"><i class="fas fa-redo mr-2"></i>Resetar</button>
</div>
</div>
</div>
</div>

<div class="card bg-white rounded-lg p-6">
<h2 class="text-xl font-semibold mb-4 text-indigo-700"><i class="fas fa-calculator mr-2"></i>Resumo do Dia</h2>
<div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
<div class="bg-blue-50 p-4 rounded-lg text-center">
<p class="text-sm text-gray-600">Horas Trabalhadas</p>
<p id="totalHours" class="text-2xl font-bold text-blue-700">0h 0m</p>
</div>
<div class="bg-yellow-50 p-4 rounded-lg text-center">
<p class="text-sm text-gray-600">Horas com Multiplicador</p>
<p id="multipliedHours" class="text-2xl font-bold text-yellow-700">0h 0m</p>
</div>
<div class="bg-green-50 p-4 rounded-lg text-center">
<p class="text-sm text-gray-600">Valor Total</p>
<p id="totalValue" class="text-2xl font-bold text-green-700">R$ 0,00</p>
</div>
</div>
<div class="mt-4">
<h3 class="text-lg font-medium mb-2 text-gray-700">Detalhes do Cálculo</h3>
<div id="calculationDetails" class="text-sm text-gray-600 p-3 bg-gray-50 rounded">
Preencha os horários e valor por hora para ver o cálculo detalhado.
</div>
</div>
</div>
</div>

<div>
<div class="card bg-white rounded-lg p-6 h-full">
<div class="flex justify-between items-center mb-4">
<h2 class="text-xl font-semibold text-indigo-700"><i class="fas fa-history mr-2"></i>Histórico</h2>
<button id="exportPdfBtn" class="text-sm bg-indigo-600 text-white px-3 py-1 rounded-md hover:bg-indigo-700"><i class="fas fa-file-pdf mr-1"></i>Exportar PDF</button>
</div>

<div class="mb-4">
<select id="historyFilter" class="w-full p-2 border border-gray-300 rounded-md mb-2">
<option value="all">Todos os registros</option>
<option value="normal">Dias normais</option>
<option value="sunday">Domingos</option>
<option value="holiday">Feriados</option>
<option value="last7">Últimos 7 dias</option>
<option value="month">Este mês</option>
<option value="range">Período específico</option>
</select>
<div id="dateRangeInputs" class="hidden">
<div class="grid grid-cols-2 gap-2">
<input type="date" id="startDate" class="p-2 border border-gray-300 rounded-md">
<input type="date" id="endDate" class="p-2 border border-gray-300 rounded-md">
</div>
<button id="applyDateRange" class="w-full mt-2 bg-indigo-600 text-white px-3 py-1 rounded-md hover:bg-indigo-700"><i class="fas fa-filter mr-1"></i>Aplicar Filtro</button>
</div>
</div>

<div class="mb-4 text-right">
<div class="text-sm text-gray-600">
<span id="totalWorkedHours">Total horas: 0h</span> | 
<span id="totalEarned">Total ganho: R$0,00</span>
</div>
</div>

<div id="historyList" class="overflow-y-auto max-h-[500px]">
<div class="text-center text-gray-500 py-4">Nenhum registro encontrado</div>
</div>
</div>
</div>
</div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Data do dia local
    const today = new Date();
    const formattedDate = today.getFullYear() + '-' + 
                          String(today.getMonth() + 1).padStart(2,'0') + '-' + 
                          String(today.getDate()).padStart(2,'0');
    document.getElementById('workDate').value = formattedDate;

    loadHistory();

    ['startTime', 'endTime', 'breakTime', 'hourlyRate', 'dayType'].forEach(id => {
        document.getElementById(id).addEventListener('change', calculateWork);
    });

    document.getElementById('startTimerBtn').addEventListener('click', startTimer);
    document.getElementById('stopTimerBtn').addEventListener('click', stopTimer);
    document.getElementById('resetTimerBtn').addEventListener('click', resetTimer);
    document.getElementById('saveEntryBtn').addEventListener('click', saveEntry);
    document.getElementById('historyFilter').addEventListener('change', function() {
        const showDateRange = this.value === 'range';
        document.getElementById('dateRangeInputs').classList.toggle('hidden', !showDateRange);
        if (!showDateRange) loadHistory();
    });
    document.getElementById('applyDateRange').addEventListener('click', loadHistory);
    document.getElementById('exportPdfBtn').addEventListener('click', exportToPDF);
});

// Timer
let timerInterval, timerSeconds = 0, timerRunning = false;

function startTimer() {
    if (!timerRunning) {
        const now = new Date();
        const hours = String(now.getHours()).padStart(2,'0');
        const minutes = String(now.getMinutes()).padStart(2,'0');
        document.getElementById('startTime').value = `${hours}:${minutes}`;
        timerRunning = true;
        document.getElementById('timerSection').classList.remove('hidden');
        timerInterval = setInterval(() => { timerSeconds++; updateTimerDisplay(); }, 1000);
        calculateWork();
    }
}
function stopTimer() {
    if (timerRunning) {
        const now = new Date();
        const hours = String(now.getHours()).padStart(2,'0');
        const minutes = String(now.getMinutes()).padStart(2,'0');
        document.getElementById('endTime').value = `${hours}:${minutes}`;
        clearInterval(timerInterval);
        timerRunning = false;
        calculateWork();
    }
}
function resetTimer() { clearInterval(timerInterval); timerRunning=false; timerSeconds=0; document.getElementById('timerDisplay').textContent='00:00:00'; document.getElementById('startTime').value=''; document.getElementById('endTime').value=''; }
function updateTimerDisplay() { const h=Math.floor(timerSeconds/3600), m=Math.floor((timerSeconds%3600)/60), s=timerSeconds%60; document.getElementById('timerDisplay').textContent=`${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`; }

// Cálculo
function calculateWork() {
    const startTime = document.getElementById('startTime').value;
    const endTime = document.getElementById('endTime').value;
    const breakTime = parseInt(document.getElementById('breakTime').value)||0;
    const hourlyRate = parseFloat(document.getElementById('hourlyRate').value)||0;
    const dayType = document.getElementById('dayType').value;
    if (!startTime||!endTime) return;

    const [sh, sm]=startTime.split(':').map(Number);
    const [eh, em]=endTime.split(':').map(Number);
    let start=new Date(2000,0,1,sh,sm);
    let end=new Date(2000,0,1,eh,em);
    let diffMs=end-start;
    if(diffMs<0) diffMs+=24*60*60*1000;
    let totalMinutes=Math.floor(diffMs/(1000*60))-breakTime;
    if(totalMinutes<0) totalMinutes=0;
    const hours=Math.floor(totalMinutes/60);
    const minutes=totalMinutes%60;

    let multiplier=1;
    if(dayType==='sunday') multiplier=2;
    else if(dayType==='holiday') multiplier=3;

    const multipliedMinutes=totalMinutes*multiplier;
    const mHours=Math.floor(multipliedMinutes/60);
    const mMinutes=multipliedMinutes%60;

    const totalValue=(multipliedMinutes/60)*hourlyRate;

    document.getElementById('totalHours').textContent=`${hours}h ${minutes}m`;
    document.getElementById('multipliedHours').textContent=`${mHours}h ${mMinutes}m`;
    document.getElementById('totalValue').textContent=`R$ ${totalValue.toFixed(2)}`;

    document.getElementById('calculationDetails').innerHTML=`
    <p>Horas trabalhadas: ${hours}h ${minutes}m</p>
    <p>Horas com multiplicador (${multiplier}x): ${mHours}h ${mMinutes}m</p>
    <p>Valor por hora: R$ ${hourlyRate.toFixed(2)}</p>
    <p>Total a receber: R$ ${totalValue.toFixed(2)}</p>
    `;
}

// Histórico
function loadHistory() {
    let entries=JSON.parse(localStorage.getItem('workEntries')||'[]');
    const filter=document.getElementById('historyFilter').value;

    if(filter==='normal'||filter==='sunday'||filter==='holiday') entries=entries.filter(e=>e.dayType===filter);
    else if(filter==='last7') {
        const today=new Date(); const weekAgo=new Date(today); weekAgo.setDate(today.getDate()-6);
        entries=entries.filter(e=>{
            const [y,m,d]=e.date.split('-').map(Number); const entryDate=new Date(y,m-1,d);
            return entryDate>=weekAgo && entryDate<=today;
        });
    }
    else if(filter==='month') {
        const today=new Date(); const month=today.getMonth(), year=today.getFullYear();
        entries=entries.filter(e=>{ const [y,m,d]=e.date.split('-').map(Number); return y===year && m-1===month; });
    }
    else if(filter==='range') {
        const start=document.getElementById('startDate').value;
        const end=document.getElementById('endDate').value;
        if(start&&end) {
            const [sy,sm,sd]=start.split('-').map(Number);
            const [ey,em,ed]=end.split('-').map(Number);
            const startDate=new Date(sy,sm-1,sd);
            const endDate=new Date(ey,em-1,ed);
            entries=entries.filter(e=>{ const [y,m,d]=e.date.split('-').map(Number); const entryDate=new Date(y,m-1,d); return entryDate>=startDate && entryDate<=endDate; });
        }
    }

    const list=document.getElementById('historyList');
    list.innerHTML='';
    if(entries.length===0) list.innerHTML='<div class="text-center text-gray-500 py-4">Nenhum registro encontrado</div>';
    else {
        entries.forEach((e,i)=>{
            const div=document.createElement('div');
            div.className=`history-item flex justify-between items-center p-3 mb-2 rounded cursor-pointer ${e.dayType==='normal'?'day-normal':e.dayType==='sunday'?'day-sunday':'day-holiday'}`;
            div.innerHTML=`<div>
            <p class="font-semibold">${e.date}</p>
            <p>${e.startTime} - ${e.endTime} | Pausa: ${e.breakTime}min</p>
            <p>R$ ${e.totalValue.toFixed(2)}</p>
            </div>
            <button onclick="deleteEntry(${i})" class="text-red-600 hover:text-red-800"><i class="fas fa-trash"></i></button>`;
            list.appendChild(div);
        });
    }

    const totalWorked=entries.reduce((acc,e)=>{
        const [sh,sm]=e.startTime.split(':').map(Number);
        const [eh,em]=e.endTime.split(':').map(Number);
        let diff=(new Date(2000,0,1,eh,em)-new Date(2000,0,1,sh,sm))/60000-e.breakTime;
        if(diff<0) diff+=24*60;
        return acc+diff;
    },0);
    const totalHours=Math.floor(totalWorked/60);
    const totalMinutes=Math.floor(totalWorked%60);
    const totalEarned=entries.reduce((acc,e)=>acc+e.totalValue,0);

    document.getElementById('totalWorkedHours').textContent=`Total horas: ${totalHours}h ${totalMinutes}m`;
    document.getElementById('totalEarned').textContent=`Total ganho: R$ ${totalEarned.toFixed(2)}`;
}

function saveEntry() {
    const date=document.getElementById('workDate').value;
    const startTime=document.getElementById('startTime').value;
    const endTime=document.getElementById('endTime').value;
    const breakTime=parseInt(document.getElementById('breakTime').value)||0;
    const hourlyRate=parseFloat(document.getElementById('hourlyRate').value)||0;
    const dayType=document.getElementById('dayType').value;
    if(!date||!startTime||!endTime) return alert('Preencha data, hora de entrada e saída');

    const [sh,sm]=startTime.split(':').map(Number);
    const [eh,em]=endTime.split(':').map(Number);
    let diff=(new Date(2000,0,1,eh,em)-new Date(2000,0,1,sh,sm))/60000-breakTime;
    if(diff<0) diff+=24*60;

    let multiplier=1; if(dayType==='sunday') multiplier=2; else if(dayType==='holiday') multiplier=3;
    const totalValue=(diff*multiplier/60)*hourlyRate;

    const entry={date,startTime,endTime,breakTime,hourlyRate,dayType,totalValue};
    const entries=JSON.parse(localStorage.getItem('workEntries')||'[]');
    entries.push(entry);
    localStorage.setItem('workEntries',JSON.stringify(entries));
    alert('Registro salvo com sucesso!');
    loadHistory();
}

// Deletar
function deleteEntry(index){
    let entries=JSON.parse(localStorage.getItem('workEntries')||'[]');
    if(confirm('Deseja realmente apagar este registro?')) {
        entries.splice(index,1);
        localStorage.setItem('workEntries',JSON.stringify(entries));
        loadHistory();
    }
}

// PDF
async function exportToPDF() {
    const history=document.getElementById('historyList');
    if(history.innerHTML.trim()==='Nenhum registro encontrado') return alert('Nenhum registro para exportar');
    const canvas=await html2canvas(history);
    const imgData=canvas.toDataURL('image/png');
    const pdf=new jspdf.jsPDF();
    const imgProps=pdf.getImageProperties(imgData);
    const pdfWidth=pdf.internal.pageSize.getWidth();
    const pdfHeight=(imgProps.height*pdfWidth)/imgProps.width;
    pdf.addImage(imgData,'PNG',0,0,pdfWidth,pdfHeight);
    pdf.save('historico.pdf');
}
</script>
</body>
</html>
